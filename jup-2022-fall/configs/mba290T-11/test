#
#
# Tony Cricelli 2022
#  Testing Yaml File for use with GCP Autopilot
#
#
scheduling:
  userScheduler:
    enabled: true
  podPriority:
    enabled: true
  userPlaceholder:
    enabled: true
    replicas: 4
#cull:
#  enabled: true
#  timeout: 3600
#  every: 300
prePuller:
  continuous:
    enabled: false
  hook:
    enabled: false
singleuser:
  cloudMetadata:
    blockWithIptables: false
  image:
#    name: montereytony/mba247-11
#    tag: local4
    name: montereytony/ugba-rah-sp22
    tag: jup2-02
  defaultUrl: "/tree"
  memory:
    limit: 2G
    guarantee: 1G
  cpu:
    limit: 1
    guarantee: .25
  storage:
    type: static
    storageClass: "class-preterm2022"
    static:
      pvcName: preterm2022-pvc
      subPath: '{username}'
    extraVolumeMounts:
      - name: jupyterhub-shared
        mountPath: /home/jovyan/shared
        readOnly: true
    extraVolumes:
      - name: jupyterhub-shared
        persistentVolumeClaim:
          claimName: preterm2022-pvc-sh
  extraEnv:
    CHOWN_HOME: "yes"
  uid: 1022
  fsGid: 1023
  lifecycleHooks:
    postStart:
      exec:
        command:
          - "sh"
          - "-c"
          - >
            mkdir -p my-work
proxy:
  secretToken: "a10101010109bf1431f96de9b40b9306b0a9d67568529909c8152cf871000fbb"
  https:
    enabled: true
    hosts:
      - preterm2022.haastech.org
    letsencrypt:
      contactEmail: tony_cricelli@berkeley.edu
  service:
    loadBalancerIP: 34.71.203.188
#  traefik:
#    extraInitContainers:
#      # This startup delay can help the k8s container network interface setup
#      # network routing of traffic to the pod, which is essential for the ACME
#      # challenge submitted by Traefik on startup to acquire a TLS certificate.
#      # Sleeping for 7 seconds has been consistently sufficient to avoid issues
#      # in GKE when this workaround was explored initially for GKE.
#      #
#      - name: startup-delay
#        image: busybox:stable
#        command: ["sh", "-c", "sleep 10"]
jupyterhub:
  hub:
    # See: https://jupyterhub.readthedocs.io/en/stable/api/app.html
    activity_resolution: 120  # Default 30.
    hub_activity_interval: 600  # Default 300.
    last_activity_interval: 300  # Default 300, 60 in z2jh helm chart.
    init_spawners_timeout: 1  # Default 10
hub:
  cookieSecret: "0101010103006d8f4efc7dcd2822a113772849327bceec4e313f3400000f29aa"
  db:
    type: sqlite-memory
  extraConfig:
    announcements: |
      c.JupyterHub.template_vars.update({ 'announcement': '<br/>Hi, this is Tony@haas.berkeley.edu, I designed this hub, so let know if you run into any problems..<br/> This hub is hosted on Google Cloud.<br/>', })
  config:
    DummyAuthenticator:
      password: Welcome_FTMBA
    JupyterHub:
      authenticator_class: dummy
    Authenticator:
      admin_users:
        - tony
        - thomasyl
      allowed_users:
        - zane
        - pchew
